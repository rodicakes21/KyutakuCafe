{% extends "store/base.html" %}
{% load static %}

{% block title %}Receipt - Kyūtakuh's Cafē{% endblock %}

{% block content %}

<div style="max-width:700px; margin:40px auto; padding:25px; background: rgba(40,15,55,0.8);
border-radius:15px; border:2px solid #FF8AD4; box-shadow:0 0 20px rgba(255,138,212,0.3);">

    <h2 style="text-align:center; color:#FFB3E6; text-shadow:0 0 10px #FF8AD4;">Receipt</h2>

    <!-- Customer Info -->
    <div style="margin-bottom:20px;">
        <h3 style="color:#FFB3E6;">Customer Information</h3>
        <p><strong>Name:</strong> {{ order.customer_name }}</p>
        <p><strong>Address:</strong> {{ order.address }}</p>
        <p><strong>Email:</strong> {{ order.email }}</p>
        <p><strong>Phone:</strong> {{ order.phone }}</p>
        <p><strong>Order Date:</strong> {{ order.created_at|date:"M d, Y H:i" }}</p>
    </div>

    <!-- Purchased Products -->
    <div>
        <h3 style="color:#FFB3E6;">Products Purchased</h3>

        <table style="width:100%; border-collapse:collapse; color:#FFE6F7;">
            <thead>
                <tr style="border-bottom:2px solid #FF8AD4;">
                    <th style="text-align:left; padding:8px;">Product</th>
                    <th style="text-align:center; padding:8px;">Qty</th>
                    <th style="text-align:right; padding:8px;">Price</th>
                    <th style="text-align:right; padding:8px;">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                <tr>
                    <td style="padding:8px;">{{ item.product.name }}</td>
                    <td style="text-align:center; padding:8px;">{{ item.quantity }}</td>
                    <td style="text-align:right; padding:8px;">₱{{ item.product.price }}</td>
                    <td style="text-align:right; padding:8px;">₱{{ item.total_price }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3 style="text-align:right; color:#FFB3E6; margin-top:15px;">
            Grand Total: ₱<span id="grandTotal">{{ order.total_price }}</span>
        </h3>

        <!-- Editable Cash Input -->
        <div style="margin-top:20px; text-align:right; color:#FFE6F7;">
            <label><strong>Total Cash:</strong></label>
            <input id="cashInput" type="number" min="0" 
                   style="padding:8px; border-radius:6px; border:1px solid #FF8AD4; width:150px; margin-left:10px;">
        </div>

        <!-- Auto Calculated Change -->
        <div style="margin-top:10px; text-align:right; color:#FFB3E6;">
            <h3>Change: ₱<span id="changeOutput">0</span></h3>
        </div>

    </div>
</div>

<!-- JavaScript for Auto Calculation -->
<script>
    const cashInput = document.getElementById("cashInput");
    const changeOutput = document.getElementById("changeOutput");
    const grandTotal = parseFloat(document.getElementById("grandTotal").innerText);

    cashInput.addEventListener("input", () => {
        const cash = parseFloat(cashInput.value) || 0;
        const change = cash - grandTotal;

        changeOutput.textContent = change >= 0 ? change.toFixed(2) : "0.00";
    });
</script>

{% endblock %}
